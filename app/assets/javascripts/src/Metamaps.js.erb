var Metamaps = {};
/*
 * The Metamaps variable declaration above defines a Javascript object that will
 * contain all of the variables and functions used by us. They are broken down
 * into sub modules that can be organized into two groups:
 *
 * All pages in Metamaps need these objects:
 *
 * GlobalUI
 * Active
 * Maps
 * Mappers
 * Backbone
 * 
 * Pages that use the Javacsript InfoVis Toolkit (Topic or Map) additionally
 * require these files:
 *
 * Settings
 * Touch
 * Mouse
 * Selected
 * Metacodes
 * Topics
 * Synapses
 * Mappings
 * Create
 * TopicCard
 * SynapseCard
 * Visualize
 * Util
 * Realtime
 * Control
 * Filter
 * Listeners
 * Organize
 * Map
 * Mapper
 * Topic
 * Synapse
 * JIT 
 *
 */


// TODO eliminate these 4 global variables
var labelType, useGradients, nativeTextSupport, animate;

(function () {
    var ua = navigator.userAgent,
        iStuff = ua.match(/iPhone/i) || ua.match(/iPad/i),
        typeOfCanvas = typeof HTMLCanvasElement,
        nativeCanvasSupport = (typeOfCanvas == 'object' || typeOfCanvas == 'function'),
        textSupport = nativeCanvasSupport && (typeof document.createElement('canvas').getContext('2d').fillText == 'function');
    //I'm setting this based on the fact that ExCanvas provides text support for IE
    //and that as of today iPhone/iPad current text support is lame
    labelType = (!nativeCanvasSupport || (textSupport && !iStuff)) ? 'Native' : 'HTML';
    nativeTextSupport = labelType == 'Native';
    useGradients = nativeCanvasSupport;
    animate = !(iStuff || !nativeCanvasSupport);
})();

// TODO eliminate these 4 global variables
var panningInt; // this variable is used to store a 'setInterval' for the Metamaps.JIT.SmoothPanning() function, so that it can be cleared with window.clearInterval
var tempNode = null,
    tempInit = false,
    tempNode2 = null;

Metamaps.Active = {
    Map: null,
    Topic: null,
    Mapper: null
};

Metamaps.Maps = {};

$(document).ready(function () {

    for (var prop in Metamaps) {

        // this runs the init function within each sub-object on the Metamaps one
        if (Metamaps.hasOwnProperty(prop) &&
            Metamaps[prop].hasOwnProperty('init') &&
            typeof (Metamaps[prop].init) == 'function'
        ) {
            Metamaps[prop].init();
        }
    }

    // initialize the famous ui
    var callFamous = function(){
        if (Metamaps.Famous) {
            Metamaps.Famous.build();
        }
        else {
            setTimeout(callFamous, 100);
        }
    }
    callFamous();
});

